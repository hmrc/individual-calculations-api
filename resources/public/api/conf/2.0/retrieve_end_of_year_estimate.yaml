get:
  tags:
    - Self Assessment
  summary: Retrieve Self Assessment Tax Calculation End Of Year Estimate
  description: |
    This endpoint allows you to retrieve the end of year Income Tax and National Insurance contribution estimates 
    for a given NINO and Calculation ID. Only applicable for an In-year calculation.
    
    An error will occur if your calculation has one or more error messages. 
    You can use the Retrieve Self Assessment Tax Calculation Messages endpoint to retrieve these messages.    
    
    ### Test data
    Scenario simulations using `Gov-Test-Scenario` headers is only available in the sandbox environment.
    
    | Header Value (Gov-Test-Scenario)   | Scenario                                                                                                   |
    |------------------------------------|------------------------------------------------------------------------------------------------------------|
    | N/A - DEFAULT                      | Simulates returning a tax calculation with all fields.<br><br>Please note the values do not represent a realistic tax calculation and is intended to show all fields being populated. |
    | ERROR_MESSAGES_EXIST               | Simulates the scenario where errors exist and no calculation has been generated.                          |
    | NOT_FOUND                         | Simulates the scenario where no data can be found.                                                         |
    | EOY_ESTIMATE_NOT_PRESENT          | Simulates the error returned when a tax calculation is not in year.                                       |
    | UK_MULTIPLE_INCOMES_EXAMPLE        | Simulates an example tax calculation for a UK FHL Property business with Savings and Dividends.           |
    | UK_PROP_DIVIDENDS_EXAMPLE          | Simulates an example tax calculation for a UK Non-FHL Property business with Dividends.                   |
    | UK_PROP_GIFTAID_EXAMPLE            | Simulates an example tax calculation for a UK Non-FHL Property business with Gift Aid.                    |
    | UK_PROP_SAVINGS_EXAMPLE            | Simulates an example tax calculation for a UK Non-FHL Property business with Savings.                     |
    | UK_SE_GIFTAID_EXAMPLE              | Simulates an example tax calculation for a UK Self-Employment business with Gift Aid.                      |
    | UK_SE_SAVINGS_EXAMPLE              | Simulates an example tax calculation for a UK Self-Employment business with Savings.                       |
    | SCOT_SE_DIVIDENDS_EXAMPLE          | Simulates an example tax calculation for a Scottish Self-Employment business with Dividends.              |


  parameters:
    - $ref: ./common/pathParameters.yaml#/components/parameters/nino
    - $ref: ./common/pathParameters.yaml#/components/parameters/calculationId
    - $ref: ./common/headers.yaml#/components/parameters/acceptJson
    - $ref: ./common/headers.yaml#/components/parameters/authorizationReadScopeHeader
    - $ref: ./common/headers.yaml#/components/parameters/testScenarioHeader

  security:
    - User-Restricted:
        - read:self-assessment

  responses:
    200:
      description: Success
      headers:
        X-CorrelationId:
          $ref: ./common/headers.yaml#/components/parameters/correlationId
      content:
        application/json:
          schema:
            $ref: ./schemas/selfAssessment/retrieveTaxCalc/retrieve_eoyEstimate_response.json
          examples:
            example-1:
              description: Example calculation response.
              value:
                $ref: ./examples/selfAssessment/retrieveEoyEstimate/retrieve_response.json

    400:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: ./schemas/error-response.yaml
          examples:
            FORMAT_NINO:
              $ref: ./common/errors.yaml#/components/examples/formatNino
            FORMAT_CALC_ID:
              $ref: ./common/errors.yaml#/components/examples/formatCalcId
            RULE_INCORRECT_GOV_TEST_SCENARIO:
              $ref: ./common/errors.yaml#/components/examples/ruleIncorrectGTS

    403:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: ./schemas/error-response.yaml
          examples:
            CLIENT_OR_AGENT_NOT_AUTHORISED:
              $ref: ./common/errors.yaml#/components/examples/clientOrAgentNotAuthorised
            RULE_CALCULATION_ERROR_MESSAGES_EXIST:
              $ref: ./common/errors.yaml#/components/examples/ruleCalculationErrorMessagesExist

    404:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: ./schemas/error-response.yaml
          examples:
            MATCHING_RESOURCE_NOT_FOUND:
              $ref: ./common/errors.yaml#/components/examples/notFoundRetrieveTaxCalc
            END_OF_YEAR_ESTIMATE_NOT_PRESENT:
              $ref: ./common/errors.yaml#/components/examples/notFoundEoyEstimate
